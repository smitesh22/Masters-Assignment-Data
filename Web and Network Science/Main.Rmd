---
title: "Untitled"
author: "Smitesh Patil"
date: '2023-02-01'
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

1. Basic measures

```{r}
library(igraph)
library(kableExtra)
dib_graph<-read.graph("dib2.graphml",format="graphml")
```

1.1 Give the number of nodes and edges

```{r}
cat("num vertices:", vcount(dib_graph), "\n")

cat("num edges :", ecount(dib_graph), "\n")
```
1.2 Is the network strongly or weakly connected. If neither, what is the distribution of
component sizes.

1. Strongly connected components
```{r}
strong_component = as.data.frame(table(factor(components(dib_graph, mode="strong")$csize)))
names(strong_component)[1] = "Component Size"
kable(strong_component)
```
Answer: The table above shows strongly connected components in the directed network. There is one component with 5479, 6 and 5 nodes and a distribution of component with sizes varying from 1 to 4.

2. Weakly connected components

```{r}
weak_component = as.data.frame(table(factor(components(dib_graph, mode="weak")$csize)))
names(weak_component)[1] = "Component Size"
kable(weak_component)
```
Answer: The table above shows weakly connected components in the directed network. There is one component with 8872 and 4 nodes with 30 weakly connected components of size 2 and 11 components with size 3.

1.3 What is the diameter of the network ?

```{r}
cat("The diameter of the network is : ", diameter(dib_graph, directed = T, unconnected = TRUE, weights=NA), "\n")
```
1.4 What is the average path length of the network ?

```{r}
cat("The average path length of the network :", mean_distance(dib_graph, directed = T), "\n")
```
1.5 What is the clustering coefficient of the network ?

```{r}
cat("The clustering coeff of the graph is :", transitivity(dib_graph, type="localaverage"), "\n")
```
1.6 What is the in- and out-degree distribution ?

```{r}
deg<-degree(dib_graph, mode = "in")
cat("The in-degree distribution of the graph varies from ", min(deg), "to ", max(deg))
```

```{r}
hist(deg, 
     breaks=(min(deg)-1):(max(deg))+0.5,
     xlab = "In-degree", 
     ylab = "Proportion", 
     main = "Histogram of In-Degree Distribution",
     border="black", 
     col="white", 
     )
```

```{r}
deg<-degree(dib_graph, mode = "out")
cat("The in-degree distribution of the graph varies from ", min(deg), "to ", max(deg))
```

```{r}

hist(deg, 
     breaks=(min(deg)-1):(max(deg))+0.5,
     xlab = "Out-degree", 
     ylab = "Proportion", 
     main = "Histogram of Out-Degree Distribution",
     border="black", 
     col="white")
```


```{r}
clu<-components(dib_graph,mode = "strong")

scc_index <- which.max(clu$csize)

# These are are the vertices in the largest SCC
scc<- V(dib_graph)[which(clu$membership==scc_index)]$name

scc_career<- V(dib_graph)[which(clu$membership==scc_index)]$career
scc_century<- V(dib_graph)[which(clu$membership==scc_index)]$century

IN_component=c()
IN_component_career = c()
IN_component_century = c()
vertices<-V(dib_graph)

non_SCC <-vertices[!(vertices$name %in% scc)]

for (v in non_SCC){
  
  dist<- bfs(dib_graph, root=v, mode="out",unreachable =F, dist=T)$dist
  
  connected_to_SCC<-!is.nan(dist[scc])
  
  if(TRUE %in% connected_to_SCC){
    IN_component<-c(IN_component,V(dib_graph)[v]$name)
    IN_component_career <- c(IN_component_career, V(dib_graph)[v]$career)
    IN_component_century <- c(IN_component_century, V(dib_graph)[v]$century)
  }
}


OUT_component = c()
OUT_component_career = c()
OUT_component_century = c()

non_SCC2 <- vertices[!(vertices$name %in% c(scc, IN_component))]

for (v in non_SCC2){
  dist<- bfs(dib_graph, root=v, mode="in",unreachable =F, dist=T)$dist
  connected_to_non_SCC<-!is.nan(dist[scc])
  if(TRUE %in% connected_to_non_SCC){
    OUT_component<-c(OUT_component,V(dib_graph)[v]$name)
    OUT_component_career <- c(OUT_component_career, V(dib_graph)[v]$career)
    OUT_component_century <- c(OUT_component_century, V(dib_graph)[v]$century)
  }
}

tube = c()
tube_career = c()
tube_century = c()
nodes_minus_SCC <- vertices[!(vertices$name %in% scc)]
g_minus_SCC<-induced_subgraph(dib_graph ,nodes_minus_SCC)
out = c()

for (v in V(g_minus_SCC)[IN_component]){
  paths<-all_simple_paths(g_minus_SCC, from=v,to = V(g_minus_SCC)[OUT_component], mode = "out", cutoff = -1)
  tube<-c(tube, names(unlist(paths)))
}

tube<-unique(tube)

tube<-tube[!(tube %in% c(IN_component,OUT_component))]


tube_data = c()
tube_data <- V(dib_graph)[V(dib_graph)$name %in% tube]
tube_data_career <- tube_data$career
tube_data_century <- tube_data$century

length(OUT_component)
```

```{r}

library(dplyr)

components_prop <- c(length(scc), length(IN_component), length(OUT_component), length(tube))

prop_table <- prop.table(components_prop) *100

names(prop_table) <- c("SCC", "IN Component", "OUT component", "Tube")

kable(prop_table, col.names = "Percentage")
```

```{r}
library(dplyr)

scc_career <- trimws(unlist(strsplit(scc_career, split = ",")))
scc_career <- as_tibble(table(scc_career)) %>% arrange(desc(n)) %>% head()


IN_component_career <- trimws(unlist(strsplit(IN_component_career, split = ",")))
IN_component_career <- as_tibble(table(IN_component_career)) %>% arrange(desc(n)) %>% head()

OUT_component_career <- trimws(unlist(strsplit(OUT_component_career, split = ",")))
OUT_component_career <- as_tibble(table(OUT_component_career)) %>% arrange(desc(n)) %>% head()


tube_component_career <- trimws(unlist(strsplit(tube_data_career, split = ",")))
tube_component_career <- as_tibble(table(tube_component_career)) %>% arrange(desc(n)) %>% head()

knitr::kable(list(scc_career, IN_component_career, OUT_component_career,tube_component_career))
```

```{r}

library(dplyr)


scc_century <- as_tibble(table(scc_century)) %>% arrange(desc(n)) %>% head()

IN_component_century <- as_tibble(table(IN_component_century)) %>% arrange(desc(n)) %>% head()

OUT_component_century <- as_tibble(table(OUT_component_century)) %>% arrange(desc(n)) %>% head()

tube_component_century <- as_tibble(table(tube_data_century)) %>% arrange(desc(n)) %>% head()

knitr::kable(list(scc_century, IN_component_century, OUT_component_century,tube_component_century))
```
```{r}

library(sjmisc)
  
century_data <- list(induced.subgraph(dib_graph, V(dib_graph)[V(dib_graph)$century == 15]),
                     induced.subgraph(dib_graph, V(dib_graph)[V(dib_graph)$century == 16]),
                     induced.subgraph(dib_graph, V(dib_graph)[V(dib_graph)$century == 17]),
                     induced.subgraph(dib_graph, V(dib_graph)[V(dib_graph)$century == 18]),
                     induced.subgraph(dib_graph, V(dib_graph)[V(dib_graph)$century == 19]),
                     induced.subgraph(dib_graph, V(dib_graph)[V(dib_graph)$century == 20]))


page_rank <- vector(mode = "list", length = 6)
katz_centrality <- vector(mode = "list", length = 6)
eigen_centrality <- vector(mode = "list", length = 6)
between <- vector(mode = "list", length = 6)
close <- vector(mode = "list", length = 6) 

names(century_data) <- c("15th century", 
                         "16th century",
                         "17th century",
                         "18th century",
                         "19th century",
                         "20th century")


for(i in 1:length(century_data)){
  page_rank[[i]] <- page_rank(century_data[[i]],  directed = TRUE, damping = 0.85)$vector
  eigen_centrality[[i]] <- eigen_centrality(century_data[[i]], weights=NA)$vector
  page_rank[[i]] <- page_rank[[i]] %>% sort(decreasing = TRUE) %>% head(1)
  eigen_centrality[[i]] <- eigen_centrality[[i]] %>% sort(decreasing = TRUE) %>% head(1)
  between[[i]] <- betweenness(century_data[[i]], weights=NA)
  between[[i]] <- between[[i]] %>% sort(decreasing = TRUE) %>% head(1)
}

out <- tibble(page_rank = names(unlist(page_rank)), 
              eigen_centrality = names(unlist(eigen_centrality)), 
              between = names(unlist(between)))
out <- rotate_df(out)

colnames(out) <-  c("15th century", 
                         "16th century",
                         "17th century",
                         "18th century",
                         "19th century",
                         "20th century")
kable(out)
              
```
