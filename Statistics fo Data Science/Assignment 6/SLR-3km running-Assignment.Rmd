---
title: "Simple Linear Regression Assignment"
author: "Smitesh Patil, id=22223696"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  pdf_document: default
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Predicting 3 km Running Times based on laboratory testing.

### Study Description: 
Sixteen well-trained male middle and long distance runners performed a 3 km time trial and a number of running tests in the laboratory including their running velocity at a blood lactate concentration of 4 mmol.l-1 (v4mM).  Other variables measured were running velocity at their Lactate Threshold (vTlac), and VO2 max. All the laboratory testing took place on a motorised treadmill, and distance running performance was determined by 3 km time trials on an indoor 200m track.

### Aims: 
To investigate whether there is we can use linear regression to predict 3 km running time (minutes) from v-4mM (km per hour) in the population of well-trained male middle and long distance runners.  Hence to predict 3km running time using running velocity at blood lactate concentration 4 mmol per litre.

- Response Variable:		3km running time (`Running.Time`) measured in minutes

- Explanatory Variable:	running velocity at blood lactate concentration at 4mmol per litre (`v4mM`) measured in km/hr


```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
library(tidyverse)
```

### Read the data and see a few rows

```{r}
running = read.csv("3krunning.csv", header = TRUE)
head(running)
```

### Summary Statistics

Task: Calculate the summary statistics for each column in the data and describe the key features of the data. 

Interpretation : Mean of vTlac is the mean threshold value of blood lactate and mean of v4mM is the lactate value of is greater than threshold (17.06). Average running time for athletes is 9.45 minutes. Our task is to find relation between v4mM and running.Time. to see if we can predict running.time based on v4mM value.

``` {r}
running %>%
  summarise(Mean_v4mM = mean(v4mM),
            SD_v4mM = sd(v4mM),
            Mean_running.Time = mean(Running.Time),
            SD_running.Time = sd(Running.Time),
            Mean_vTlac = mean(vTlac),
            SD_vTlac = sd(vTlac),
            Mean_Rel.14.5 = mean(Rel.14.5),
            SD_Rel.14.5 = sd(Rel.14.5),
            Mean_Rel.16.1 = mean(Rel.16.1),
            SD_Rel.16.1 = sd(Rel.16.1),
            Mean_VO2Max = mean(VO2Max),
            SD_VO2Max = sd(VO2Max)
 
            
            )

```

### Scatterplot

Task: Make a labelled scatterplot of `v4mM` vs `Running.Time` and interpret it.

Interpretation : On a look, it seems that the variables Running.Time and v4mM have a negative correlation. I.E as the value of Running.Time increases value of v4mM decreases.

``` {r}

ggplot(running, aes(x = v4mM , y = Running.Time))+
  xlab("v4mM in km per hour")+
  ylab("Running time in minutes")+
  geom_point()

```


### Scatterplot with smoother.

Task: Add a smooth line to the scatter plot produced in the previous task, and include the new plot below.

Interpretation : Smoothing aids us to see a pattern by plotting a line and intervals to a certain width, here we can obeserve for certain that there is a negative correlation between Running.Time and v4mM. Using pearson correlation would give us concrete proof of a negative correlation.  

``` {r}


ggplot(running, aes(x = v4mM , y = Running.Time))+
  geom_point()+
  xlab("v4mM in km per hour")+
  ylab("Running time in minutes")+
  geom_smooth()
```


Task: What does the smoother suggest regarding the suitability of a simple linear regression model for this relationship?

Interpretation : In simple linear regression, we try to fit our hypothesis (a line) by calculating error on existing hypothesis and recalculating slope and intercept. The smoother suggest we can fit a line to relatively good accuracy to predict Running.Time based on its v4mM value. A simple linear regression model, basically refers to the fact that there is a single dependent variable (v4mM) for predicting the target variable (Running.Time)

### Correlation coefficient

Task: calculate the correlation coefficient between `v4mM` vs `Running.Time` and interpret it.

Interpretation : Correlation value of -0.925857 between v4mM and Running.Time supports our interpretation that the two variables are highy correlated negatively.

``` {r}

running %>% select(v4mM, Running.Time) %>% cor()

```


### Scatterplot with line of best fit

Task: Add the line of best fit to the scatter plot produced above and interpret it.

Interpretation :geom_smooth  or stats_smooth are used to plot a hypothesis for the input data. The se=FALSE argument causes the line to not plot confidence interval and in method we pass lm to plot linee based on linear model.

``` {r}

ggplot(running, aes(x = v4mM , y = Running.Time))+
  geom_point()+
  xlab("v4mM in km per hour")+
  ylab("Running time in minutes")+
  geom_smooth(method = "lm", se = FALSE)
```
### Fitting a Simple Linear Regression Model
  
Task: Estimate the parameters of the line of best fit for the linear relationship between 3 km running time and v-4mM in the sample.  This can then be used for inference about the linear relationship in the population of well-trained male middle and long distance runners.

Interpretation : by running the lm function and passing Running.Time and v4mM, you can predict Running.Time values based on the v4mM values. This gives us the intercept and slope values which can be used to plot our hypothesis with value y = mx+c. The values of parameters are the slope value m = -0.3729 and value of y-intercept 15.82223

``` {r}

model = lm(Running.Time ~ v4mM, running)
model

```


### Equation of line of best fit
Task: Write down the equation of the line of best fit and also provide an interpretation of the slope and intercept. Does the intercept have a physically meaningful interpretation?

Interpretation : Here the line equation is of the format y = mx +c where m is the slope of the line and c is the y-intercept of the line. by using slope and the y intercept you can plot any line on a number-plane.

``` {r}

equation = paste("Y = ", model$coefficients[-1],"*X + ",  model$coefficients[1])
equation
```

### Make some point predictions

Task: Predict the running time (i.e. `Running.Time`) when running speed at blood lactate concentration 4 mmol/litre  (i.e. `v4mM`) are 14, 15, 16, 17, 18, 19 and 20 km per hour. 

``` {r}

v4mM_pred = data.frame(
  v4mM = c(14, 15, 16, 17, 18, 19, 20))

```

### Interval estimation for predicted running times

For each of the predictions produce a 95% confidence interval and 95% prediction interval, and interpret the results carefully.

Interpretation : 95% confidence interval tells us that we are 95% confident that true mean lies between two values, whereas 95% prediction interval tells us that individual values of data lies between two values. Consequently, prediction intervals are larger than confidence interval.

```{r}
predict(model, newdata = v4mM_pred, interval = "confidence")
predict(model, newdata = v4mM_pred, interval = "prediction")

```


### Plots with confidence and prediction intervals

Task: Add the 95% confidence and 95% prediction intervals to the scatter plot with the line of best fit, and interpret.

Interpretation : In the below plot, blue dashed line indicate the confidence interval, whereas the red dashed line indicate prediction interval. As stated before, the prediction interval is larger in range than confidence interval as it gives probability of values lying between two values whereas prediction interval whereas confidence does the  same with the true mean.

``` {r}
preds_prediction = predict(model, newdata = running, interval = "prediction")

preds_prediction <- data.frame(preds_prediction)

preds_prediction <- preds_prediction %>% rename(
  fit = fit,
  lwr_pred = lwr,
  upr_pred = upr
)

preds_confidence = predict(model, newdata = running, interval = "confidence")

preds_confidence <- data.frame(preds_confidence)

preds_confidence <- preds_confidence %>% rename(
  lwr_con = lwr,
  upr_con = upr
) %>%
  select(lwr_con, upr_con)


df2 = data.frame(cbind(running, preds_confidence, preds_prediction))

ggplot(df2, aes(y = Running.Time, x = v4mM)) +
         geom_point() +
          stat_smooth(method = lm) +
          geom_line(aes(y = lwr_pred), color = "red", linetype = "dashed")+
          geom_line(aes(y = upr_pred), color = "red", linetype = "dashed")+
          geom_line(aes(y = upr_con), color = "blue", linetype = "dashed")+
          geom_line(aes(y = lwr_con), color = "blue", linetype = "dashed")+
          xlab("v4mM in km per hour")+
          ylab("Running time in minutes")
```


### More prediction

Task: Predict the running time (i.e. `Running.Time`) when running speed at blood lactate concentration 4 mmol/litre (i.e. `v4mM`) is 18.9 km per hour. 

``` {r}
predict(model, newdata = data.frame(v4mM = 18.9))
```


Task: Why is the result here is different from 8.82, the observed running time when running speed at blood lactate concentration 4 mmol/litre (`v4mM`) is 18.9 mmol.l-1? (see observation row 4) 

Interpretation : This is because the value given as prediction by our linear model is just an estimated value that it learns by training on the data provided. The model accuracy depends on many factors like the size of the dataset, the features of the dataset, hyperparamters of the model, etc. Hence, the value of running speed is different than the one predicted.

Task: Predict the running time (i.e. `Running.Time`) when  `v4mM` is 2.6 km per hour. Explain if you have any concern related to this prediction.

Interpretation : Yes, I am concerned with this prediciton. The value of 'v4mM' provided is an outlier. The values of 'v4mM' are provided in range of 14.2 km/hr to 20.4 km/hr as 2.6 km/hr value is an outlier the value that our hypothesis predicts would not be considered accurate as our model has not trained on data around that value.

``` {r}

predict(model, newdata = data.frame(v4mM = 2.6))

```


### Overall Conclusion 

Task: State your overall conclusions from fitting a linear model for the relationship between 3k running time and the running speed at blood lactate concentration 4 mmol/litre.

Answer : In brief, we found out that variables v4mM and Running.Time are highly negatively correlated hence, we can use the value of v4mM to predict running.time. We ran a simple linear regression model and used the model trained on data to make some predictions. We later stated out that prediction on outliers could be ambigious as the dataset doesn't contain any observed value in that range.

