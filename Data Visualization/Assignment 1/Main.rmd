---
title: "Main_Out"
author: "Smitesh Patil"
date: "2023-02-13"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
options(warn=-1)
```

```{r}
library(ggplot2)
library(dplyr)
library(gghighlight)
library(forcats)
df <- read.csv("Counsumer_Price_Index.csv")

df <- df %>%
  rename(Location = Ã¯..Location)

sav <- df %>%
  filter(Location %in% c("IRL", "CAN", "AUS",
                            "USA", "FRA", "DEU",
                            "ESP", "ITA", "NLD", "OECD")) %>%
  filter(Time == "2022-12") %>%
  mutate(Location = recode(Location, 
                           "IRL" = "IRELAND",
                           "AUS" = "AUSTRALIA",
                           "USA" = "UNITED STATES",
                           "DEU" = "GERMANY",
                           "CAN" = "CANADA",
                           "ESP" = "SPAIN",
                           "ITA" = "ITALY",
                           "FRA" = "FRANCE",
                           "NLD" = "NETHERLANDS")) %>%
  filter(Subject != "Energy")


order <- sav %>% 
      filter(Subject == "Food") %>%
      arrange(Percentage) %>%
      select(Location) %>%
      unlist() %>%
      unname()

order <- replace(order, c(1,2), order[c(2,1)])
```

```{r, fig.height = 7, fig.width = 14}

colorblind_colors <- colorBlindness::availableColors()
sav %>%
  ggplot(aes(x = factor(Location, levels = order), y = Percentage)) +
  geom_col(data = filter(sav, Location == "IRELAND"), fill = colorblind_colors[2],
           linewidth=0.2, position="dodge")+
  geom_col(data = filter(sav, Location == "OECD"), fill = colorblind_colors[3], 
           linewidth=0.2, position="dodge")+
  xlab("Countries --> ") +
  geom_col(data = filter(sav, !Location %in% c("OECD", "IRELAND")), 
           fill = colorblind_colors[4] ,linewidth=0.2, position="dodge")+
  xlab("Countries --> ") +
  ylab("Increase in CPI by % -->")+
  facet_grid(~Subject, 
             labeller = as_labeller(c("Food" = "Food",
                                      "Total" = "Total",
                                      "Total_Minus_Food_Energy" = "Excluding Food & Expenses")))+
  coord_flip()+
  labs(fill = "Country / Organization")+
  scale_y_continuous(breaks = round(seq(0, 20, by = 1),1))+
  scale_fill_discrete(name = "Country / Organization", 
                      labels = c("OECD", "Other countries in OECD", "IRELAND")) + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), 
        legend.position = "top",)+
  ggtitle(label = "Increase in inflation (by CPI) in Ireland compared to OECD and other countries in OECD")+
  theme_light()
```

```{r fig.height = 7, fig.width = 14}
order <- sav %>% 
      filter(Subject == "Food") %>%
      arrange(Percentage) %>%
      select(Location) %>%
      unlist() %>%
      unname()

order <- replace(order, c(1,2), order[c(2,1)])

sav %>%
  mutate(Location = factor(Location, levels = order)) %>%
  ggplot(aes(x = Location, y = Percentage, color = Subject)) +
  geom_point(data = ~ mutate(., Percentage = if_else(Location == "Ireland", Percentage[NA], Percentage)),
             size = 4, position = position_dodge(0.5), na.rm = TRUE) +
  geom_point(data = ~ filter(., Location == "IRELAND"),
             size = 6, position = position_dodge(1)) +
  geom_linerange(data = ~ filter(., Location == "IRELAND"),
                 aes(ymin = 0, ymax = Percentage), 
                 position = position_dodge(0.5),
                 linetype = "dotdash") + 
  geom_linerange(data = ~ filter(., Location != "IRELAND"),
                 aes(ymin = 0, ymax = Percentage),
                 position = position_dodge(0.5), linetype = "dotdash") + 
  coord_flip()+
  ggtitle(label = "Increase in inflation (by CPI) in Ireland compared to OECD and other countries in OECD")+
  xlab("Countries --> ") +
  ylab("Increase in CPI by % -->")+
  scale_y_continuous(breaks = round(seq(0, 20, by = 1),1))+
  scale_color_manual(name = "Type of Items", 
                     labels = c("Food", "Total", "Excluding food and energy"),
                     values=c(unname(colorblind_colors[2]), 
                              unname(colorblind_colors[3]), 
                              unname(colorblind_colors[4])))+
  theme(panel.grid.major.x = element_line(linewidth =.01, color="black"),
        panel.grid.major.y = element_blank(),
        legend.position = "top"
        )
```